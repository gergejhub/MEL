<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MEL Ops Assistant (LIDO 4D)</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="title">MEL Ops Assistant</div>
    <div class="subtitle">MEL / limitation → LIDO 4D teendők + operációs korlátok (multi-limitáció)</div>
  </div>
  <div class="right">
    <label class="file">
      <input id="pdfFile" type="file" accept="application/pdf"/>
      <span>+ MEL PDF betöltése (lokálisan)</span>
    </label>
    <div class="pill" id="dbStatus">DB: betöltés…</div>
    <div class="pill" id="pdfStatus">PDF: nincs betöltve</div>
  </div>
</header>

<main class="layout2">
  <section class="panel left">

    <div class="card compactSearch">
      <div class="cardHeader">
        <div>
          <div class="cardTitle">Keresés</div>
          <div class="muted">MEL szám / kulcsszó / szövegrészlet</div>
        </div>
      </div>
      <div class="searchRow">
        <input class="search" id="q" placeholder="Pl. 22-82-01 • TCAS • CPDLC • RNP APCH • WX RADAR…"/>
        <button class="btn primary" id="btnSearch">Keresés</button>
      </div>
      <details class="advanced">
        <summary>Haladó opciók</summary>
        <div class="toggles">
          <label><input id="searchActions" type="checkbox" checked/> Strukturált teendő-adatbázis (Excel)</label>
          <label><input id="searchPdf" type="checkbox" checked/> MEL PDF keresés (lokálisan a böngészőben)</label>
        </div>
      </details>
      <div class="results" id="results"></div>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div class="cardTitle">AMOS CSV import (flotta)</div>
        <button class="btn" id="btnCopyHandover" title="Dispatcher handover export">Handover export</button>
      </div>
      <div class="muted" style="margin-bottom:8px;">
        Tölts fel egy AMOS “WO Summary” CSV-t, vagy másold be a teljes tartalmát. A rendszer A/C szerint csoportosít,
        és kiemeli a dispatcher‑releváns tételeket.
      </div>
      <div class="row" style="gap:10px; flex-wrap:wrap;">
        <label class="file">
          <input id="amosCsvFile" type="file" accept=".csv,text/csv"/>
          <span>+ CSV betöltése</span>
        </label>
        <button class="btn" id="btnImportCsv">Import</button>
        <button class="btn" id="btnAddRelevantFromCsv">Dispatcher‑relevánsak aktívba</button>
        <button class="btn danger" id="btnClearCsv">CSV törlés</button>
      </div>
      <details class="advanced" style="margin-top:10px;">
        <summary>CSV paste (opcionális)</summary>
        <textarea class="bulk" id="amosCsvPaste" placeholder="Ide is beillesztheted a teljes CSV tartalmat…" rows="6"></textarea>
      </details>
      <div class="muted" id="amosCsvReport">—</div>
      <div class="delta" id="deltaReport">—</div>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div class="cardTitle">Dispatch‑releváns repülőgépek</div>
        <div class="pill" id="selectedAcPill" title="Kijelölt lajstrom">A/C: —</div>
      </div>
      <div class="muted" id="relevantAcSummary">—</div>
      <div class="acList" id="relevantAcList">—</div>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div class="cardTitle">Aktív limitációk (kombinált)</div>
      </div>
      <div class="activeRow">
        <input class="search" id="manualAdd" placeholder="Adj hozzá kézzel egy címkét (pl. 'WX RADAR INOP', 'MAX FL 330')…"/>
        <button class="btn" id="btnAddManual">Hozzáadás</button>
        <button class="btn danger" id="btnClearActive">Törlés</button>
      </div>
      <div class="chips" id="activeList"></div>
      <details class="advanced">
        <summary>Gyors import (több sor)</summary>
        <textarea class="bulk" id="bulkPaste" placeholder="Példa:
9H-WDJ  ATC DATALINK / CPDLC INOP
9H-WMP  NAV DB OUTDATED (RNP APCH not permitted)
9H-WMC  SINGLE ENGINE BLEED / NO FL LIMIT" rows="6"></textarea>
        <div class="row">
          <button class="btn" id="btnBulkAdd">Feldolgozás + aktívba</button>
          <button class="btn" id="btnBulkClear">Mező ürítése</button>
        </div>
        <div class="muted" id="bulkReport"></div>
      </details>
    </div>

  </section>

  <section class="panel right">

    <div class="card">
      <div class="cardHeader">
        <div class="cardTitle" id="summaryHeader">Összegzett teendők</div>
        <button class="btn" id="btnCopySummary">Másolás</button>
      </div>
      <pre class="summary" id="summary">Nincs aktív limitáció.</pre>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div class="cardTitle">PDF találatok</div>
        <div class="muted" id="pdfProgress"></div>
      </div>
      <div class="muted" id="pdfAutoHints">—</div>
      <div class="pdfHits" id="pdfHits">—</div>
    </div>

    <div class="footnote">
      Tipp: ha FL LIMIT aktív, írd be a kézi címkébe pl. <b>FL350</b> vagy <b>MAX FL 330</b> is, hogy a számítás tudjon “min”-t venni.
    </div>

  </section>
</main>

<footer class="footer">
  <div>Offline működés: a PDF-t nem küldi sehova, a böngésződben dolgozza fel. GitHub Pages kompatibilis (statikus).</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
  if (window.pdfjsLib && window.pdfjsLib.GlobalWorkerOptions) {
    window.pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
  }
</script>
<script src="app.js"></script>
</body>
</html>
